# Модуль синхронизации пользователей из сторонней базы данных

Для чего нужен модуль:

Представим, что есть сайт или сайты на Drupal 7, расположены они внутри Интранет сети которая построена на Active Directory.
Сеть находится внутри компании у которой есть сторонне ПО для работы с кадрами, а данное ПО использует базу данных для хранения
информации о сотрудниках (Oracle, MySQL без разницы)

Необходимо сделать так, чтобы пользователи из базы данных сотрудников синхронизировались с сайтом на Drupal-е, чем чаще тему лучше,
а именно чтобы сайт как минимум 1 раз в час синхронизировал все данные из сторонней базы.

Для удобства на сторонней базе данных подготовлена views которая формирует таблицу всех сотрудников с информацией,
в информации присутствуют следующие поля:
LOGIN,EMAIL,PERSONNEL_NUMBER,FULL_NAME,PHONE

Таким образом для Drupal-а программа минимум это поля LOGIN и EMAIL, однако т.к. в связи с тем что человек может изменить фамилию,
а из-за этого у него изменится логин, нужно иметь некое поле всегда неизменное для сохранения связи между пользователями базы данных
сотрудников и Drupal-ом - в этом случае отлично подходит PERSONNEL_NUMBER - это табельный номер, он всегда с сотрудником, никогда не меняется, никогда не занимается другим сотрудником.

Таким образом стоит следующая задача:
  1) при включении модуля он должен создать нужные поля в сущности user, чтобы на каждом сайте не приходилось их ручным способом создавать
  2) модуль должен иметь свой php файл для своего крона, чтобы можно было обращаться на уровне сервера к данному файлу по расписанию для запуска процесса синхронизации, т.е. его запуск должен быть отдельно от стандартного крона, и должен проходить полностью между запусками стандартного крона
  3) модуль должен формировать очередь с помощью Queue API по 30 секунд на запуск (т.к. сотрудников для синхронизации порядка 12 000)
  4) модуль в момент синхронизации при отсутствии пользователя (а наличие должен искать по полю PERSONNEL_NUMBER, т.е. если в системе отсуствует пользователь с PERSONNEL_NUMBER например 14230, то значит он отсутствует в системе и его нужно создать) должен создать
  5) модуль в момент синхронизации в случае присутствии пользователя должен полностью синхронизировать пользователя по всем полям (не обращая внимания, изменились ли они, или остались те же самые, т.е. просто полностью переписать данные)
  6) модуль должен обработать очередь максимум 1 раз в час, т.е. если на сервере он запускается каждые 5 минут, а за этот промежуток он успевает обработать ровно 4000 сотрудников, получается ему для обработки 12000 сотрудников ему нужно 3 запуска, так вот если первый запуск произойдет в 13:30, второй 13:35, а третий в 13:40, то вновь очередь должна запуститься уже только в следующий раз в 14:30, т.е. спустя час после запуска предыдущего первого запуска.
